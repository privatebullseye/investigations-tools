<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Titan Securities Pty Ltd – Advertising & Website Change Request</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --primary:#0b2a3c;
      --accent:#b71c1c;
      --bg:#f4f6f8;
      --card:#ffffff;
      --text:#1f2328;
      --muted:#4b5563;
      --soft:#eef2f6;
      --border:#d9e1ea;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,sans-serif;background:var(--bg);color:var(--text)}
    header{background:var(--primary);color:#fff;padding:18px;text-align:center}
    header h1{margin:0;font-size:18px;letter-spacing:.05em;text-transform:uppercase}
    header p{margin:6px 0 0;font-size:13px;opacity:.92}
    main{max-width:980px;margin:18px auto 44px;padding:0 14px}
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      padding:16px;
      margin-bottom:14px;
      box-shadow:0 2px 8px rgba(0,0,0,.06)
    }
    h2{margin:0 0 10px;font-size:16px;color:var(--primary)}
    p{margin:8px 0;color:var(--muted);font-size:14px;line-height:1.4}
    label{display:block;margin:10px 0 6px;font-size:13px;color:var(--muted)}
    input, select, textarea{
      width:100%;
      padding:10px;
      border:1px solid var(--border);
      border-radius:8px;
      font-size:14px;
      background:#fff;
    }
    textarea{min-height:120px;resize:vertical}
    .grid{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1 1 280px}
    .warn{
      border-left:4px solid var(--accent);
      background:#fff7f7;
      border-radius:10px;
      padding:10px;
      color:#7a1c1c
    }
    .soft{
      background:var(--soft);
      border:1px solid var(--border);
      border-radius:10px;
      padding:10px
    }
    .row{display:flex;gap:10px;align-items:flex-start;margin-top:10px}
    .row input{width:auto;margin-top:3px}
    button{
      background:var(--primary);
      color:#fff;
      border:none;
      border-radius:8px;
      padding:11px 16px;
      font-size:15px;
      cursor:pointer
    }
    button:disabled{opacity:.6;cursor:default}
    #out{
      margin-top:12px;
      background:var(--soft);
      border:1px solid var(--border);
      border-radius:10px;
      padding:10px;
      font-size:13px;
      white-space:pre-wrap
    }
    .tiny{font-size:12px;color:#6b7280}
    .pill{
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      background:var(--soft);
      border:1px solid var(--border);
      font-size:12px;
      color:#374151;
      margin-top:6px;
    }
  </style>
</head>

<body>
<header>
  <h1>Titan Securities Pty Ltd</h1>
  <p>Advertising & Website Change Request (Compliance Log Entry)</p>
</header>

<main>

  <section class="card">
    <h2>What this page is for</h2>
    <p>
      Use this page to lodge advertising and marketing items for review before publishing. It creates an entry in Titan’s Advertising
      Compliance Log (Google Sheets), which supports supervision records and helps demonstrate that Titan knows what advertising is being proposed.
    </p>
    <div class="warn">
      Website submissions: this form is for major advertising or disclosure changes only (for example, headline claims, landing pages,
      promotional banners, pricing/fee statements, “about” claims, key disclosures, or representative identification wording).
      It is not for day-to-day advice content supplied on your website.
    </div>
    <p class="tiny">
      After submitting this form, email the advertising material (text, screenshots, artwork, PDFs, or links) to Titan Securities for approval.
      Do not publish until approval has been provided.
    </p>
    <span class="pill">Password required to submit: titan</span>
  </section>

  <section class="card">
    <h2>Representative details (required)</h2>

    <div class="grid">
      <div class="col">
        <label for="repName">Representative name</label>
        <input id="repName" type="text" placeholder="e.g., George Smith" autocomplete="name" />
      </div>

      <div class="col">
        <label for="repEmail">Representative email</label>
        <input id="repEmail" type="email" placeholder="e.g., george@example.com" autocomplete="email" />
      </div>

      <div class="col">
        <label for="carName">CAR name (if applicable)</label>
        <input id="carName" type="text" placeholder="e.g., ABC Pty Ltd" />
      </div>
    </div>

    <label for="password">Submission password (required)</label>
    <input id="password" type="password" placeholder="Enter password" />

    <div class="soft">
      <div class="row">
        <input id="consentChk" type="checkbox" />
        <div class="tiny">
          I consent to this submission being recorded for supervision and compliance purposes, including capture of my public IP address (where available).
        </div>
      </div>
    </div>

    <div id="out">Complete the required fields above, then add optional advertising details below and submit.</div>
  </section>

  <section class="card">
    <h2>Advertising details (optional but recommended)</h2>

    <p class="tiny">
      You can submit with only representative details, password, and consent.
      If you leave optional fields blank, Titan will follow up by email if clarification is needed.
    </p>

    <div class="grid">
      <div class="col">
        <label for="platform">Platform</label>
        <select id="platform">
          <option value="">(Optional) Select…</option>
          <option>Website</option>
          <option>LinkedIn</option>
          <option>Facebook</option>
          <option>Instagram</option>
          <option>Email</option>
          <option>Google Ads</option>
          <option>PDF / Brochure</option>
          <option>Other</option>
        </select>
      </div>

      <div class="col">
        <label for="handle">Account / handle</label>
        <input id="handle" type="text" placeholder="(Optional) e.g., @companyname or domain" />
      </div>

      <div class="col">
        <label for="requestType">Request type</label>
        <select id="requestType">
          <option value="">(Optional) Select…</option>
          <option>New content</option>
          <option>Edit existing content</option>
          <option>Paid promotion</option>
          <option>Website disclosure update</option>
          <option>Landing page</option>
          <option>Other</option>
        </select>
      </div>
    </div>

    <div class="grid">
      <div class="col">
        <label for="contentType">Content type</label>
        <select id="contentType">
          <option value="">(Optional) Select…</option>
          <option>Post</option>
          <option>Advertisement</option>
          <option>Website page</option>
          <option>Email</option>
          <option>PDF</option>
          <option>Other</option>
        </select>
      </div>

      <div class="col">
        <label for="audience">Audience</label>
        <select id="audience">
          <option value="">(Optional) Select…</option>
          <option>Retail</option>
          <option>Wholesale / 708 only</option>
          <option>Internal</option>
          <option>Not sure</option>
        </select>
      </div>

      <div class="col">
        <label for="personalAdviceRisk">Personal advice risk</label>
        <select id="personalAdviceRisk">
          <option value="">(Optional) Select…</option>
          <option>Low</option>
          <option>Medium</option>
          <option>High</option>
        </select>
      </div>
    </div>

    <label for="targetUrl">Target URL (draft or final)</label>
    <input id="targetUrl" type="text" placeholder="(Optional) https://…" />

    <label for="extractCopy">Advertising extract / summary (recommended)</label>
    <textarea id="extractCopy" maxlength="900" placeholder="Paste a short extract or summary (recommended). If the full advert is long, paste only the key extract here and email the full version."></textarea>
    <p class="tiny">
      Note: to keep the log readable, this field is limited to 900 characters. Email the full advert if longer.
    </p>

    <label for="notesToTitan">Notes to Titan (optional)</label>
    <textarea id="notesToTitan" maxlength="900" placeholder="Any context you want Titan to consider."></textarea>

    <div class="soft">
      <div class="row">
        <input id="chkDisclaimers" type="checkbox" />
        <div class="tiny">Disclaimers included where applicable.</div>
      </div>

      <div class="row">
        <input id="chkFsg" type="checkbox" />
        <div class="tiny">FSG access included where applicable.</div>
      </div>

      <div class="row">
        <input id="chkImpersonation" type="checkbox" />
        <div class="tiny">Impersonation warning / verification pathway included where applicable.</div>
      </div>
    </div>

    <button id="btn">Submit to Titan Advertising Log</button>
    <p class="tiny">
      If the submission logs successfully, you will see a confirmation message. Then email the advertising materials to Titan for approval.
    </p>
  </section>

</main>

<script>
  // Your deployed Apps Script Web App endpoint
  const GOOGLE_SCRIPT_URL =
    "https://script.google.com/macros/s/AKfycbxmMCl55HQzgNw1yPBHk9saXXIg4kWLrYsxE92ApffUnqYrA8K45Gd23ROiidwC_LPpVA/exec";

  // Grab elements safely (do not rely on global ID variables)
  const el = (id) => document.getElementById(id);

  const repName = el("repName");
  const repEmail = el("repEmail");
  const carName = el("carName");
  const password = el("password");
  const consentChk = el("consentChk");

  const platform = el("platform");
  const handle = el("handle");
  const requestType = el("requestType");
  const contentType = el("contentType");
  const audience = el("audience");
  const personalAdviceRisk = el("personalAdviceRisk");
  const targetUrl = el("targetUrl");
  const extractCopy = el("extractCopy");
  const notesToTitan = el("notesToTitan");

  const chkDisclaimers = el("chkDisclaimers");
  const chkFsg = el("chkFsg");
  const chkImpersonation = el("chkImpersonation");

  const btn = el("btn");
  const out = el("out");

  function setOut(msg){
    out.textContent = (typeof msg === "string") ? msg : JSON.stringify(msg, null, 2);
  }

  async function getIP(){
    try{
      const r = await fetch("https://api.ipify.org?format=json", { cache:"no-store" });
      if(!r.ok) return "Unavailable";
      const j = await r.json();
      return j.ip || "Unavailable";
    }catch{
      return "Unavailable";
    }
  }

  // To reduce spreadsheet bloat, send a controlled-length summary
  function normaliseExtract(text){
    const t = (text || "").trim();
    if(!t) return ""; // optional
    return t.length > 900 ? t.slice(0, 900) : t;
  }

  // Provide safe defaults so your Apps Script (if it validates required fields) won’t reject blanks
  function withDefaults(v, fallback){
    const t = (v || "").trim();
    return t ? t : fallback;
  }

  btn.addEventListener("click", async () => {
    try{
      // REQUIRED MINIMUMS
      if(!repName.value.trim()) return setOut("Representative name is required.");
      if(!repEmail.value.trim()) return setOut("Representative email is required.");
      if(!password.value.trim()) return setOut("Password is required.");
      if(!consentChk.checked) return setOut("Consent is required.");

      btn.disabled = true;
      setOut("Submitting…");

      const publicIP = await getIP();

      // IMPORTANT:
      // If your Apps Script currently enforces required advertising fields, these defaults ensure it still writes the row.
      // You can change defaults later once you confirm your server-side rules.
      const payload = {
        consent: true,
        password: password.value.trim(),

        repName: repName.value.trim(),
        repEmail: repEmail.value.trim(),
        carName: carName.value.trim(),

        // Optional fields sent with safe defaults so the server can always log the submission
        platform: withDefaults(platform.value, "Website"),
        handle: handle.value.trim(),
        requestType: withDefaults(requestType.value, "Website disclosure update"),
        contentType: withDefaults(contentType.value, "Website page"),
        audience: withDefaults(audience.value, "Not sure"),
        personalAdviceRisk: personalAdviceRisk.value || "Low",

        // Use extract/summary instead of full copy (keeps sheet readable)
        targetUrl: targetUrl.value.trim(),
        draftCopy: normaliseExtract(extractCopy.value), // keep key extract only
        notesToTitan: normaliseExtract(notesToTitan.value),

        disclaimersIncluded: !!chkDisclaimers.checked,
        fsgLinkIncluded: !!chkFsg.checked,
        impersonationWarningIncluded: !!chkImpersonation.checked,

        publicIP: publicIP,
        pageUrl: location.href,
        userAgent: navigator.userAgent
      };

      // Post to Apps Script (GitHub Pages -> Apps Script)
      // Use text/plain and no-cors to avoid preflight/CORS blocks.
      await fetch(GOOGLE_SCRIPT_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type":"text/plain;charset=utf-8" },
        body: JSON.stringify(payload)
      });

      setOut(
        "Submitted successfully.\n\nNext step:\nEmail the advertising material to Titan Securities for approval (include screenshots, artwork, PDFs, or links)."
      );

    } catch (err) {
      setOut({ success:false, error: err.message || String(err) });
    } finally {
      btn.disabled = false;
    }
  });
</script>

</body>
</html>
